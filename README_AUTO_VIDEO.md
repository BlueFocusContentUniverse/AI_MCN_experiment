# 高灵活性视频自动混剪系统

这是一个基于自然语言需求驱动的高灵活性视频自动混剪系统，可以将用户的文字需求转换为完整的视频作品。

## 系统概述

本系统采用独特的"需求解析-中间表示-执行"流程，具有以下特点：

1. **自然语言输入**：用户只需要描述想要的视频效果，系统会自动解析并生成标准化的视频制作指令
2. **灵活性高**：无需预定义模板，能够处理各种类型的视频制作需求
3. **口播与视觉协同**：精确控制口播、背景音乐和原声的协同关系
4. **智能素材匹配**：多维度的素材搜索和排序策略
5. **批量处理**：支持批量提交和处理任务
6. **任务管理**：完整的任务状态追踪和管理功能

## 系统架构

系统由以下主要组件构成：

- **前端界面**：基于Streamlit的用户交互界面
- **需求解析引擎**：将自然语言需求转换为标准中间表示(IR)
- **素材搜索引擎**：多策略的视频素材智能匹配
- **音频处理系统**：口播生成与多轨音频混合
- **视频处理引擎**：基于IR执行视频剪辑和后期处理
- **任务管理系统**：任务创建、监控和状态更新

## 快速开始

### 安装依赖

```bash
# 安装依赖
pip install -r requirements.txt
```

### 启动前端界面

```bash
# 启动Streamlit应用
cd streamlit_app
streamlit run app.py
```

### 启动工作机

```bash
# 启动工作机处理任务
python worker.py --output-dir ./output
```

## 使用指南

### 1. 创建视频任务

1. 打开前端界面，点击"自动视频创作"
2. 在文本框中输入你的视频需求描述，如：
   - "制作一个奔驰C级的30秒宣传片，强调豪华内饰和驾驶体验，使用专业男声配音，适合在朋友圈分享"
3. 选择相关的品牌和车型
4. （可选）配置高级选项
5. 点击"生成预览"查看系统理解的需求
6. 确认无误后，点击"提交任务"

### 2. 查看任务状态

1. 在"查看已提交任务"标签页可以看到所有任务的状态
2. 选择任务可以查看详情，包括处理进度和结果
3. 对于已完成的任务，可以直接预览和下载视频

### 3. 管理任务

1. 可以取消正在处理或等待中的任务
2. 可以删除不再需要的任务
3. 可以查看任务的详细参数和处理记录

## 中间表示(IR)格式

系统使用标准化的中间表示(IR)格式作为需求解析和执行的桥梁，主要包含以下部分：

1. **metadata**：项目元数据，包括ID、时长、目标平台等
2. **audio_design**：音频设计，包含口播、背景音乐和音效等
3. **visual_structure**：视觉结构，包含视频分段、转场等
4. **post_processing**：后期处理，包含字幕、滤镜、标志等
5. **export_settings**：导出设置，包含格式、质量等

## 高级使用

### 自定义任务优先级

可以通过设置任务优先级来控制处理顺序：
- high：优先处理
- normal：正常优先级
- low：低优先级

### 调整素材搜索策略

在高级选项中可以调整素材搜索策略：
- vector：基于语义向量的搜索（默认）
- keyword：基于关键词的精确匹配
- hybrid：混合搜索策略

## 常见问题

**Q: 如何制作特定风格的视频？**  
A: 在需求描述中明确提出风格要求，例如"动感、科技感的风格"、"温馨、舒适的氛围"等。

**Q: 如何控制口播和背景音乐的关系？**  
A: 在需求中指明，例如"背景音乐轻柔不喧宾夺主"、"口播和原声保持平衡"等。

**Q: 如何获得更好的素材匹配效果？**  
A: 提供更详细的场景描述，并确保选择正确的品牌和车型。

## 扩展与开发

### 添加新的素材搜索策略

在`EnhancedMaterialMatchingService`类中添加新的搜索方法，并在`search_materials_for_segment`方法中注册。

### 添加新的音频处理能力

扩展`FishAudioService`或创建新的音频处理服务，并在`IRVideoProcessor`中集成。

### 添加新的视频特效

在`VideoEditingService`中添加新的特效处理函数，并在编辑计划中支持相应的参数。 